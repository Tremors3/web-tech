{% extends 'base/base_column.html' %}
{% load static %}

{% block navbar %} {% include 'auctions/includes/create_navbar.html' %} {% endblock %}

{% block extra_css %} <link rel="stylesheet" type="text/css" href="{% static 'auctions/css/base.css' %}"> {% endblock %}

{% block title %}Create Auction{% endblock %}

{% block main_column %}
<div class="d-flex flex-column align-items-center gap-4 pt-5">

    <!-- FIRST SECTION -->
    <div class="card col-10 col-md-8 col-lg-6 col-xl-5 bg-white rounded shadow gap-4 py-4 px-4">
    
        <h2 class="text-center">Create a New Auction</h2>

        <form method="post" enctype="multipart/form-data" class="d-flex flex-column gap-4" novalidate>
            {% csrf_token %}

            <!-- Non Field Errors -->
            {% if form.non_field_errors %}
                <div class="alert alert-danger list-icon list-icon-error">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}

            <!-- Auction Fields -->
            <div class="d-flex flex-column border rounded bg-light-subtle gap-3 p-3">

                <h5>Enter Auction Info</h5>

                <div class="d-flex align-items-center">
                    <label class="me-3" style="width: 150px;">{{ form.title.label }}</label>
                    <div class="flex-grow-1">
                        {{ form.title }}
                    </div>
                </div>
                {% if form.title.errors %}
                    <div class="alert alert-danger list-icon list-icon-error">
                        {{ form.title.errors }}
                    </div>
                {% endif %}

                <div class="d-flex align-items-center">
                    <label class="me-3" style="width: 150px;">{{ form.image.label }}</label>
                    <div class="flex-grow-1">
                        {{ form.image }}
                    </div>
                </div>
                {% if form.image.errors %}
                    <div class="alert alert-danger list-icon list-icon-error">
                        {{ form.image.errors }}
                    </div>
                {% endif %}

                <div class="d-flex align-items-center">
                    <label class="me-3" style="width: 150px;">{{ form.description.label }}</label>
                    <div class="flex-grow-1">
                        {{ form.description }}
                    </div>
                </div>
                {% if form.description.errors %}
                    <div class="alert alert-danger list-icon list-icon-error">
                        {{ form.description.errors }}
                    </div>
                {% endif %}

                <div class="d-flex align-items-center">
                    <label class="me-3" style="width: 150px;">{{ form.technical_details.label }}</label>
                    <div class="flex-grow-1">
                        {{ form.technical_details }}
                    </div>
                </div>
                {% if form.technical_details.errors %}
                    <div class="alert alert-danger list-icon list-icon-error">
                        {{ form.technical_details.errors }}
                    </div>
                {% endif %}

            </div>

            <!-- Date Fields -->
            <div class="d-flex flex-column border rounded bg-light-subtle gap-3 p-3">
                
                <h5>Enter Dates Info</h5>

                <div class="d-flex align-items-center">
                    <label class="me-3" style="width: 150px;">{{ form.start_date.label }}</label>
                    <div class="flex-grow-1">
                        {{ form.start_date }}
                    </div>
                </div>
                {% if form.start_date.errors %}
                    <div class="alert alert-danger list-icon list-icon-error">
                        {{ form.start_date.errors }}
                    </div>
                {% endif %}

                <div class="d-flex align-items-center">
                    <label class="me-3" style="width: 150px;">{{ form.end_date.label }}</label>
                    <div class="flex-grow-1">
                        {{ form.end_date }}
                    </div>
                </div>
                {% if form.end_date.errors %}
                    <div class="alert alert-danger list-icon list-icon-error">
                        {{ form.end_date.errors }}
                    </div>
                {% endif %}

            </div>

            <!-- Price Fields -->
            <div class="d-flex flex-column border rounded bg-light-subtle gap-3 p-3">
                
                <h5>Enter Prices Info</h5>

                <!-- Min Price -->
                <div class="d-flex align-items-center gap-2">
                    <label class="me-3" style="width: 150px;">Min Price</label>
                    {{ form.min_price_eur }}
                    <span>€</span>
                    {{ form.min_price_cents }}
                    <span>cents</span>
                </div>
                {% if form.min_price_eur.errors or form.min_price_cents.errors %}
                    <div class="alert alert-danger list-icon list-icon-error">
                        {{ form.min_price_eur.errors }}
                        {{ form.min_price_cents.errors }}
                    </div>
                {% endif %}

                <!-- Buy Now Price -->
                <div class="d-flex align-items-center gap-2">
                    <label class="me-3" style="width: 150px;">Buy now price</label>
                    {{ form.buy_now_price_eur }}
                    <span>€</span>
                    {{ form.buy_now_price_cents }}
                    <span>cents</span>
                </div>
                {% if form.buy_now_price_eur.errors or form.buy_now_price_cents.errors %}
                    <div class="alert alert-danger list-icon list-icon-error">
                        {{ form.buy_now_price_eur.errors }}
                        {{ form.buy_now_price_cents.errors }}
                    </div>
                {% endif %}

            </div>

            <!-- Categoru Fields -->
            <div class="d-flex flex-column border rounded bg-light-subtle gap-3 p-3">

                <h5>Select the Auction Category</h5>
            
                <div class="d-flex align-items-center">
                    <label class="me-3" style="width: 150px;">{{ form.category.label }}</label>
                    <div class="flex-grow-1">
                        {{ form.category }}
                    </div>
                </div>
                {% if form.category.errors %}
                    <div class="alert alert-danger list-icon list-icon-error">
                        {{ form.category.errors }}
                    </div>
                {% endif %}
            </div>

            <!-- Buttons -->
            <button type="submit" class="btn btn-primary w-100">
                Create Auction
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const centFields = [
        document.getElementById('id_min_price_cents'),
        document.getElementById('id_buy_now_price_cents')
    ];

    centFields.forEach(field => {
        if (!field) return;

        field.addEventListener('input', () => {
            let val = parseInt(field.value);
            if (isNaN(val) || val < 0) val = 0;
            if (val > 99) val = 99;
            field.value = val;
        });
    });

    const eurFields = [
        document.getElementById('id_min_price_eur'),
        document.getElementById('id_buy_now_price_eur')
    ];

    eurFields.forEach(field => {
        if (!field) return;

        field.addEventListener('input', () => {
            let val = parseInt(field.value);
            if (isNaN(val) || val < 0) val = 0;
            field.value = val;
        });
    });

});
</script>
{% endblock %}